<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResQMap - Community Resource Locator Demo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .app-demo {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 40px;
            margin-bottom: 50px;
            align-items: start;
        }
        
        .phone-mockup {
            position: relative;
            width: 300px;
            height: 600px;
            background: #333;
            border-radius: 30px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            margin: 0 auto;
        }
        
        .screen {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .app-interface {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 0.8rem;
        }
        
        .app-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .app-header h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .search-bar {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            padding: 12px 20px;
            margin-bottom: 20px;
            color: #333;
            border: none;
            width: 100%;
            font-size: 0.9rem;
        }
        
        .location-display {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 0.8rem;
        }
        
        .service-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            flex: 1;
        }
        
        .service-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .service-card:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .service-card.active {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }
        
        .service-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .service-name {
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .service-count {
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 4px;
        }
        
        .demo-controls {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }
        
        .demo-controls h3 {
            margin-bottom: 20px;
            color: #FFD700;
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .demo-btn {
            padding: 12px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .demo-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .demo-btn.secondary {
            background: transparent;
            border: 2px solid #4CAF50;
        }
        
        .demo-btn.secondary:hover {
            background: #4CAF50;
        }
        
        .results-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        
        .result-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-info h4 {
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        
        .result-info p {
            font-size: 0.7rem;
            opacity: 0.8;
        }
        
        .result-distance {
            font-size: 0.8rem;
            color: #FFD700;
            font-weight: bold;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .feature-card h4 {
            margin-bottom: 10px;
            color: #87CEEB;
        }
        
        .navigation {
            text-align: center;
            margin-top: 40px;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            padding: 12px 25px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
            text-decoration: none;
            color: white;
        }
        
        .map-simulation {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0 0 20px 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
            overflow: hidden;
        }
        
        .map-simulation.active {
            opacity: 1;
        }
        
        #miniMap {
            width: 100%;
            height: 100%;
            border-radius: 0 0 20px 20px;
        }
        
        .navigation-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .navigation-panel.active {
            display: block;
            animation: slideDown 0.5s ease;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .nav-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .distance-live {
            font-size: 1.4rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
            animation: distancePulse 2s ease-in-out infinite;
        }
        
        @keyframes distancePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .eta {
            color: #E8F5E8;
            font-weight: 600;
        }
        
        .direction-arrow {
            font-size: 1.8rem;
            animation: pulse 1s ease-in-out infinite;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.15) rotate(5deg); }
        }
        
        .nav-instruction {
            text-align: center;
            font-size: 0.8rem;
            background: rgba(255,255,255,0.2);
            padding: 8px;
            border-radius: 8px;
            margin-top: 5px;
            font-weight: 600;
        }
        
        .full-map-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 10000;
            display: none;
        }
        
        .full-map-container.active {
            display: block;
        }
        
        #fullMap {
            width: 100%;
            height: 100%;
        }
        
        .map-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1001;
            display: flex;
            gap: 10px;
        }
        
        .map-btn {
            padding: 10px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .map-btn:hover {
            background: #45a049;
        }
        
        .navigation-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            z-index: 1001;
        }
        
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .nav-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            text-align: center;
        }
        
        .nav-stat {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .nav-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .nav-stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes bounceIn {
            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            70% { transform: translate(-50%, -50%) scale(0.9); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .user-marker, .user-marker-large {
            text-align: center;
            font-size: 1.2rem;
            animation: userPulse 2s ease-in-out infinite;
        }
        
        @keyframes userPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .service-marker, .service-marker-large {
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .service-marker:hover, .service-marker-large:hover {
            transform: scale(1.2);
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .location-accuracy {
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        @media (max-width: 768px) {
            .app-demo {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .phone-mockup {
                width: 250px;
                height: 500px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è ResQMap Demo</h1>
            <p>Community Resource Locator - Find Essential Services Near You</p>
        </div>
        
        <div class="app-demo">
            <div class="phone-mockup">
                <div class="screen">
                    <div class="app-interface">
                        <div class="status-bar">
                            <span>9:41</span>
                            <span>üì∂ üì∂ üì∂ üîã</span>
                        </div>
                        
                        <div class="app-header">
                            <h2>ResQMap</h2>
                            <p style="font-size: 0.8rem; opacity: 0.8;">Find resources nearby</p>
                        </div>
                        
                        <input type="text" class="search-bar" placeholder="Search for services..." readonly>
                        
                        <div class="location-display" id="locationDisplay">
                            üìç Current Location: Bhopal, India
                        </div>
                        
                        <div class="service-grid" id="serviceGrid">
                            <div class="service-card" onclick="selectService('hospitals', this)">
                                <div class="service-icon">üè•</div>
                                <div class="service-name">Hospitals</div>
                                <div class="service-count">12 nearby</div>
                            </div>
                            <div class="service-card" onclick="selectService('police', this)">
                                <div class="service-icon">üöî</div>
                                <div class="service-name">Police</div>
                                <div class="service-count">8 nearby</div>
                            </div>
                            <div class="service-card" onclick="selectService('fire', this)">
                                <div class="service-icon">üöí</div>
                                <div class="service-name">Fire Dept</div>
                                <div class="service-count">5 nearby</div>
                            </div>
                            <div class="service-card" onclick="selectService('schools', this)">
                                <div class="service-icon">üè´</div>
                                <div class="service-name">Schools</div>
                                <div class="service-count">25 nearby</div>
                            </div>
                            <div class="service-card" onclick="selectService('government', this)">
                                <div class="service-icon">üèõÔ∏è</div>
                                <div class="service-name">Gov Offices</div>
                                <div class="service-count">15 nearby</div>
                            </div>
                            <div class="service-card" onclick="selectService('pharmacies', this)">
                                <div class="service-icon">üè™</div>
                                <div class="service-name">Pharmacies</div>
                                <div class="service-count">18 nearby</div>
                            </div>
                        </div>
                        
                        <div class="results-panel" id="resultsPanel">
                            <div id="serviceResults"></div>
                        </div>
                    </div>
                    <div class="map-simulation" id="mapSimulation">
                        <div class="navigation-panel" id="navigationPanel">
                            <div class="nav-info">
                                <span class="direction-arrow">üß≠</span>
                                <span class="distance-live" id="liveDistance">2.3 km</span>
                                <span class="eta" id="eta">8 min</span>
                            </div>
                            <div class="nav-instruction">
                                Turn right in 200m ‚Üí Main Street
                            </div>
                        </div>
                        <div id="miniMap"></div>
                    </div>
                </div>
            </div>
            
            <div class="demo-controls">
                <h3>üéÆ Interactive Demo Controls</h3>
                <div class="control-buttons">
                    <button class="demo-btn" onclick="detectUserLocation()">
                        üìç Detect My Location
                    </button>
                    <button class="demo-btn secondary" onclick="simulateLocationUpdate()">
                        üîÑ Simulate Movement
                    </button>
                    <button class="demo-btn" onclick="simulateEmergencyMode()">
                        üö® Emergency Mode
                    </button>
                    <button class="demo-btn" onclick="toggleMapView()">
                        üó∫Ô∏è Toggle Map
                    </button>
                    <button class="demo-btn secondary" onclick="simulateNavigation()">
                        üß≠ Get Directions
                    </button>
                    <button class="demo-btn" onclick="openFullMap()">
                        üó∫Ô∏è Full Map View
                    </button>
                    <button class="demo-btn secondary" onclick="simulateUserAuth()">
                        üë§ User Login
                    </button>
                    <button class="demo-btn secondary" onclick="resetDemo()">
                        üîÑ Reset Demo
                    </button>
                </div>
                
                <div style="background: rgba(0, 0, 0, 0.2); border-radius: 10px; padding: 15px; margin-top: 15px;">
                    <h4 style="margin-bottom: 10px;">üìä Demo Status</h4>
                    <div id="demoStatus">
                        <p>üü¢ GPS: Active | üü¢ Firebase: Connected | üü¢ Services: 83 loaded</p>
                        <p>üë§ User: Demo Mode | üì± Platform: Android 12 | üîã Battery: 85%</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">üìç</div>
                <h4>Real-time Location</h4>
                <p>GPS-powered service discovery with accurate location tracking and proximity-based results</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üî•</div>
                <h4>Firebase Integration</h4>
                <p>Real-time database synchronization, user authentication, and cloud messaging</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üó∫Ô∏è</div>
                <h4>Interactive Maps</h4>
                <p>Detailed maps with turn-by-turn directions and service information overlay</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üö®</div>
                <h4>Emergency Access</h4>
                <p>One-tap access to emergency services with automatic location sharing</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üë•</div>
                <h4>Community Driven</h4>
                <p>User-generated content, reviews, and real-time service updates from the community</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üì±</div>
                <h4>Offline Support</h4>
                <p>Critical service information available even without internet connection</p>
            </div>
        </div>
        
        <div class="navigation">
            <a href="https://github.com/Neellohitdasgupta/ResQMap" target="_blank" class="nav-link">üíª GitHub Repository</a>
            <a href="../../index.html" class="nav-link">üè† Back to Portfolio</a>
        </div>
    </div>
    
    <!-- Full Map View -->
    <div class="full-map-container" id="fullMapContainer">
        <div class="map-controls">
            <button class="map-btn" onclick="closeFullMap()">‚úï Close</button>
            <button class="map-btn" onclick="centerOnUser()">üìç My Location</button>
            <button class="map-btn" onclick="toggleTraffic()">üö¶ Traffic</button>
        </div>
        
        <div id="fullMap"></div>
        
        <div class="navigation-info" id="navigationInfo" style="display: none;">
            <div class="nav-header">
                <h3>üß≠ Navigation Active</h3>
                <button class="map-btn" onclick="stopNavigation()" style="background: #f44336;">Stop</button>
            </div>
            <div class="nav-instruction" style="margin-bottom: 15px; font-size: 1.1rem;">
                Head north on Main Street
            </div>
            <div class="nav-stats">
                <div class="nav-stat">
                    <div class="nav-stat-value" id="fullDistance">2.3 km</div>
                    <div class="nav-stat-label">Distance</div>
                </div>
                <div class="nav-stat">
                    <div class="nav-stat-value" id="fullETA">8 min</div>
                    <div class="nav-stat-label">ETA</div>
                </div>
                <div class="nav-stat">
                    <div class="nav-stat-value" id="fullSpeed">45 km/h</div>
                    <div class="nav-stat-label">Speed</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const serviceData = {
            hospitals: [
                { name: "AIIMS Bhopal", address: "Saket Nagar, Bhopal", distance: "2.3 km", coords: [23.2156, 77.4305] },
                { name: "Hamidia Hospital", address: "Sultania Rd, Bhopal", distance: "3.1 km", coords: [23.2685, 77.4030] },
                { name: "Bansal Hospital", address: "Shahpura, Bhopal", distance: "4.2 km", coords: [23.2156, 77.4305] }
            ],
            police: [
                { name: "MP Nagar Police Station", address: "Zone-1, MP Nagar", distance: "1.8 km", coords: [23.2324, 77.4377] },
                { name: "Shahpura Police Station", address: "Shahpura, Bhopal", distance: "2.5 km", coords: [23.2156, 77.4305] },
                { name: "Habibganj Police Station", address: "Habibganj, Bhopal", distance: "3.7 km", coords: [23.2285, 77.4385] }
            ],
            fire: [
                { name: "Fire Station MP Nagar", address: "Zone-2, MP Nagar", distance: "2.1 km", coords: [23.2324, 77.4377] },
                { name: "Fire Station Shahpura", address: "Shahpura, Bhopal", distance: "3.4 km", coords: [23.2156, 77.4305] }
            ],
            schools: [
                { name: "VIT Bhopal University", address: "Kothri Kalan, Bhopal", distance: "1.5 km", coords: [23.0865, 77.3932] },
                { name: "Carmel Convent School", address: "BHEL, Bhopal", distance: "2.8 km", coords: [23.2685, 77.4030] },
                { name: "Delhi Public School", address: "Arera Colony, Bhopal", distance: "3.2 km", coords: [23.2156, 77.4305] }
            ],
            government: [
                { name: "Collectorate Office", address: "Shyamla Hills, Bhopal", distance: "2.7 km", coords: [23.2324, 77.4377] },
                { name: "Municipal Corporation", address: "Roshanpura, Bhopal", distance: "3.5 km", coords: [23.2685, 77.4030] }
            ],
            pharmacies: [
                { name: "Apollo Pharmacy", address: "MP Nagar, Bhopal", distance: "0.8 km", coords: [23.2324, 77.4377] },
                { name: "MedPlus", address: "Arera Colony, Bhopal", distance: "1.2 km", coords: [23.2156, 77.4305] },
                { name: "Wellness Forever", address: "Shahpura, Bhopal", distance: "1.9 km", coords: [23.2156, 77.4305] }
            ]
        };
        
        let currentService = null;
        let isMapVisible = false;
        let miniMap = null;
        let fullMap = null;
        let userLocation = [23.2599, 77.4126]; // Default: Bhopal coordinates (fallback)
        let actualUserLocation = null;
        let selectedDestination = null;
        let navigationActive = false;
        let routePolyline = null;
        let userMarker = null;
        let destinationMarker = null;
        let navigationInterval = null;
        let locationWatchId = null;
        let isLocationDetected = false;
        
        function selectService(serviceType, element) {
            // Remove active class from all cards
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Add active class to selected card
            if (element) {
                element.classList.add('active');
            } else {
                // Fallback: find the card by service type
                document.querySelectorAll('.service-card').forEach(card => {
                    if (card.onclick && card.onclick.toString().includes(serviceType)) {
                        card.classList.add('active');
                    }
                });
            }
            
            currentService = serviceType;
            
            // Auto-select the first destination for easier navigation
            if (serviceData[serviceType] && serviceData[serviceType].length > 0) {
                selectedDestination = serviceData[serviceType][0];
            }
            
            showServiceResults(serviceType);
            
            updateDemoStatus(`üìã Selected: ${serviceType} - Ready for navigation to ${selectedDestination?.name || 'nearest service'}`);
        }
        
        function showServiceResults(serviceType) {
            const results = serviceData[serviceType] || [];
            const resultsPanel = document.getElementById('resultsPanel');
            const serviceResults = document.getElementById('serviceResults');
            
            serviceResults.innerHTML = results.map((service, index) => `
                <div class="result-item" onclick="selectDestination('${serviceType}', ${index})">
                    <div class="result-info">
                        <h4>${service.name}</h4>
                        <p>${service.address}</p>
                    </div>
                    <div class="result-distance">${service.distance}</div>
                </div>
            `).join('');
            
            resultsPanel.style.display = 'block';
            
            // Simulate loading delay
            serviceResults.style.opacity = '0';
            setTimeout(() => {
                serviceResults.style.opacity = '1';
            }, 300);
        }
        
        function selectDestination(serviceType, index) {
            selectedDestination = serviceData[serviceType][index];
            updateDemoStatus(`üìç Selected: ${selectedDestination.name} - Ready for navigation`);
            
            // Highlight selected item
            document.querySelectorAll('.result-item').forEach((item, i) => {
                if (i === index) {
                    item.style.background = 'rgba(76, 175, 80, 0.3)';
                    item.style.border = '2px solid #4CAF50';
                } else {
                    item.style.background = '';
                    item.style.border = '';
                }
            });
        }
        
        function simulateLocationUpdate() {
            const locations = [
                "üìç Current Location: MP Nagar, Bhopal",
                "üìç Current Location: Arera Colony, Bhopal", 
                "üìç Current Location: Shahpura, Bhopal",
                "üìç Current Location: BHEL, Bhopal"
            ];
            
            const randomLocation = locations[Math.floor(Math.random() * locations.length)];
            document.getElementById('locationDisplay').textContent = randomLocation;
            
            // Update service counts
            document.querySelectorAll('.service-count').forEach(count => {
                const newCount = Math.floor(Math.random() * 30) + 5;
                count.textContent = `${newCount} nearby`;
            });
            
            updateDemoStatus("üü° Location updated - Refreshing nearby services...");
            setTimeout(() => {
                updateDemoStatus("üü¢ GPS: Active | üü¢ Firebase: Connected | üü¢ Services: 83 loaded");
            }, 2000);
        }
        
        function simulateEmergencyMode() {
            const emergencyServices = document.querySelectorAll('.service-card');
            emergencyServices.forEach(card => {
                card.style.background = 'rgba(255, 0, 0, 0.3)';
                card.style.border = '2px solid #ff4444';
            });
            
            updateDemoStatus("üö® EMERGENCY MODE ACTIVATED - Priority services highlighted");
            
            setTimeout(() => {
                emergencyServices.forEach(card => {
                    card.style.background = '';
                    card.style.border = '';
                });
                updateDemoStatus("üü¢ Emergency mode deactivated - Normal operation resumed");
            }, 3000);
        }
        
        function toggleMapView() {
            const mapSimulation = document.getElementById('mapSimulation');
            isMapVisible = !isMapVisible;
            
            if (isMapVisible) {
                mapSimulation.classList.add('active');
                initializeMiniMap();
                updateDemoStatus("üó∫Ô∏è Map view activated - Showing service locations");
            } else {
                mapSimulation.classList.remove('active');
                updateDemoStatus("üì± List view activated - Showing service details");
            }
        }
        
        function initializeMiniMap() {
            if (miniMap) {
                miniMap.remove();
            }
            
            miniMap = L.map('miniMap', {
                zoomControl: false,
                attributionControl: false
            }).setView(userLocation, 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(miniMap);
            
            // Add user location marker
            userMarker = L.marker(userLocation, {
                icon: L.divIcon({
                    html: 'üìç',
                    className: 'user-marker',
                    iconSize: [20, 20]
                })
            }).addTo(miniMap);
            
            // Add service markers if a service is selected
            if (currentService && serviceData[currentService]) {
                serviceData[currentService].forEach(service => {
                    L.marker(service.coords, {
                        icon: L.divIcon({
                            html: getServiceIcon(currentService),
                            className: 'service-marker',
                            iconSize: [20, 20]
                        })
                    }).addTo(miniMap).bindPopup(service.name);
                });
            }
        }
        
        function getServiceIcon(serviceType) {
            const icons = {
                hospitals: 'üè•',
                police: 'üöî',
                fire: 'üöí',
                schools: 'üè´',
                government: 'üèõÔ∏è',
                pharmacies: 'üè™'
            };
            return icons[serviceType] || 'üìç';
        }
        
        function simulateNavigation() {
            // If no specific destination selected, use the first service from current category
            if (!selectedDestination && currentService && serviceData[currentService]) {
                selectedDestination = serviceData[currentService][0];
                updateDemoStatus(`üìç Auto-selected: ${selectedDestination.name} for navigation`);
            }
            
            if (!selectedDestination) {
                alert("Please select a service category first (e.g., Hospitals, Police)!");
                return;
            }
            
            updateDemoStatus("üß≠ Calculating route - GPS navigation starting...");
            
            setTimeout(() => {
                startNavigation();
                updateDemoStatus("üü¢ Navigation active - Follow GPS directions");
            }, 1500);
        }
        
        function startNavigation() {
            navigationActive = true;
            
            // Show navigation panel in mini map
            document.getElementById('navigationPanel').classList.add('active');
            
            // Initialize mini map if not visible
            if (!isMapVisible) {
                toggleMapView();
            }
            
            // Add route to mini map
            if (miniMap && selectedDestination) {
                // Create a simple route line
                routePolyline = L.polyline([userLocation, selectedDestination.coords], {
                    color: '#4CAF50',
                    weight: 4,
                    opacity: 0.8
                }).addTo(miniMap);
                
                // Add destination marker
                destinationMarker = L.marker(selectedDestination.coords, {
                    icon: L.divIcon({
                        html: 'üéØ',
                        className: 'destination-marker',
                        iconSize: [25, 25]
                    })
                }).addTo(miniMap).bindPopup(selectedDestination.name);
                
                // Fit map to show both points
                miniMap.fitBounds([userLocation, selectedDestination.coords], { padding: [20, 20] });
            }
            
            // Start live distance updates
            startLiveTracking();
        }
        
        function startLiveTracking() {
            let currentDistance = parseFloat(selectedDestination.distance);
            let originalDistance = currentDistance;
            let currentETA = Math.ceil(currentDistance * 3); // Realistic ETA calculation
            let currentSpeed = 0;
            let directions = [
                "Head north on Main Street",
                "Turn right onto Park Avenue", 
                "Continue straight for 800m",
                "Turn left at the traffic light",
                "Destination will be on your right"
            ];
            let currentDirectionIndex = 0;
            
            // Update initial instruction
            updateNavigationInstruction(directions[currentDirectionIndex]);
            
            navigationInterval = setInterval(() => {
                if (!navigationActive) {
                    clearInterval(navigationInterval);
                    return;
                }
                
                // Simulate realistic movement with varying speed
                const speedVariation = 25 + Math.random() * 30; // 25-55 km/h
                const distanceReduction = (speedVariation / 60) * 0.033; // Convert to km per 2-second interval
                
                currentDistance = Math.max(0, currentDistance - distanceReduction);
                currentSpeed = speedVariation;
                
                // Recalculate ETA based on current speed
                currentETA = currentDistance > 0 ? (currentDistance / speedVariation) * 60 : 0;
                
                // Update direction instructions based on progress
                const progress = 1 - (currentDistance / originalDistance);
                const newDirectionIndex = Math.min(Math.floor(progress * directions.length), directions.length - 1);
                
                if (newDirectionIndex !== currentDirectionIndex && newDirectionIndex < directions.length) {
                    currentDirectionIndex = newDirectionIndex;
                    updateNavigationInstruction(directions[currentDirectionIndex]);
                }
                
                // Check if arrived
                if (currentDistance <= 0.05) {
                    currentDistance = 0;
                    currentETA = 0;
                    navigationActive = false;
                    
                    updateNavigationInstruction("üéâ You have arrived!");
                    
                    setTimeout(() => {
                        showArrivalNotification();
                        stopNavigation();
                    }, 2000);
                }
                
                // Update all displays with enhanced formatting
                updateNavigationDisplays(currentDistance, currentETA, currentSpeed);
                
                // Animate user movement on map
                animateUserMovement(progress);
                
            }, 1500); // Update every 1.5 seconds for smoother experience
        }
        
        function updateNavigationInstruction(instruction) {
            const instructionElements = document.querySelectorAll('.nav-instruction');
            instructionElements.forEach(element => {
                element.textContent = instruction;
                element.style.animation = 'none';
                setTimeout(() => {
                    element.style.animation = 'fadeIn 0.5s ease';
                }, 10);
            });
        }
        
        function updateNavigationDisplays(distance, eta, speed) {
            // Format distance with appropriate units
            let distanceText;
            if (distance < 1) {
                distanceText = Math.round(distance * 1000) + ' m';
            } else {
                distanceText = distance.toFixed(1) + ' km';
            }
            
            // Format ETA
            let etaText;
            if (eta < 1) {
                etaText = '< 1 min';
            } else if (eta < 60) {
                etaText = Math.ceil(eta) + ' min';
            } else {
                const hours = Math.floor(eta / 60);
                const minutes = Math.ceil(eta % 60);
                etaText = `${hours}h ${minutes}m`;
            }
            
            // Update mini map displays
            const liveDistanceEl = document.getElementById('liveDistance');
            const etaEl = document.getElementById('eta');
            
            if (liveDistanceEl) {
                liveDistanceEl.textContent = distanceText;
                // Add color coding based on distance
                if (distance < 0.5) {
                    liveDistanceEl.style.color = '#FF6B6B'; // Red when close
                } else if (distance < 1) {
                    liveDistanceEl.style.color = '#FFD93D'; // Yellow when getting close
                } else {
                    liveDistanceEl.style.color = '#6BCF7F'; // Green when far
                }
            }
            
            if (etaEl) {
                etaEl.textContent = etaText;
            }
            
            // Update full map displays
            if (fullMap) {
                const fullDistanceEl = document.getElementById('fullDistance');
                const fullETAEl = document.getElementById('fullETA');
                const fullSpeedEl = document.getElementById('fullSpeed');
                
                if (fullDistanceEl) fullDistanceEl.textContent = distanceText;
                if (fullETAEl) fullETAEl.textContent = etaText;
                if (fullSpeedEl) fullSpeedEl.textContent = Math.round(speed) + ' km/h';
            }
        }
        
        function animateUserMovement(progress) {
            if (miniMap && userMarker && selectedDestination) {
                const newLat = userLocation[0] + (selectedDestination.coords[0] - userLocation[0]) * progress;
                const newLng = userLocation[1] + (selectedDestination.coords[1] - userLocation[1]) * progress;
                
                // Smooth marker movement
                userMarker.setLatLng([newLat, newLng]);
                
                // Center map on user location as they move
                miniMap.panTo([newLat, newLng]);
            }
            
            // Update full map if active
            if (fullMap && navigationActive) {
                const fullUserMarker = fullMap.eachLayer(layer => {
                    if (layer.options && layer.options.className === 'user-marker-large') {
                        const newLat = userLocation[0] + (selectedDestination.coords[0] - userLocation[0]) * progress;
                        const newLng = userLocation[1] + (selectedDestination.coords[1] - userLocation[1]) * progress;
                        layer.setLatLng([newLat, newLng]);
                        fullMap.panTo([newLat, newLng]);
                    }
                });
            }
        }
        
        function showArrivalNotification() {
            // Create a custom arrival notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #4CAF50, #45a049);
                color: white;
                padding: 30px;
                border-radius: 20px;
                text-align: center;
                z-index: 10001;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                animation: bounceIn 0.6s ease;
            `;
            
            notification.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 15px;">üéâ</div>
                <h2 style="margin-bottom: 10px;">Destination Reached!</h2>
                <p style="font-size: 1.1rem; margin-bottom: 15px;">${selectedDestination.name}</p>
                <button onclick="this.parentElement.remove()" 
                        style="padding: 10px 20px; background: white; color: #4CAF50; border: none; border-radius: 25px; font-weight: bold; cursor: pointer;">
                    Great!
                </button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        function stopNavigation() {
            navigationActive = false;
            
            if (navigationInterval) {
                clearInterval(navigationInterval);
            }
            
            // Hide navigation panels
            document.getElementById('navigationPanel').classList.remove('active');
            document.getElementById('navigationInfo').style.display = 'none';
            
            // Remove route and destination marker
            if (routePolyline) {
                miniMap.removeLayer(routePolyline);
                routePolyline = null;
            }
            
            if (destinationMarker) {
                miniMap.removeLayer(destinationMarker);
                destinationMarker = null;
            }
            
            // Reset user marker position
            if (userMarker) {
                userMarker.setLatLng(userLocation);
            }
            
            updateDemoStatus("üõë Navigation stopped - Ready for new route");
        }
        
        function simulateUserAuth() {
            updateDemoStatus("üë§ Authenticating with Firebase...");
            
            setTimeout(() => {
                const users = ["John Doe", "Sarah Smith", "Mike Johnson", "Demo User"];
                const randomUser = users[Math.floor(Math.random() * users.length)];
                updateDemoStatus(`üë§ Welcome ${randomUser}! | üü¢ Syncing preferences...`);
            }, 2000);
        }
        
        function resetDemo() {
            // Reset all selections
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Hide results
            document.getElementById('resultsPanel').style.display = 'none';
            
            // Hide map
            document.getElementById('mapSimulation').classList.remove('active');
            isMapVisible = false;
            
            // Reset location
            document.getElementById('locationDisplay').textContent = "üìç Current Location: Bhopal, India";
            
            currentService = null;
            updateDemoStatus("üîÑ Demo reset - Ready for new interaction");
        }
        
        function updateDemoStatus(message) {
            const statusElement = document.getElementById('demoStatus');
            statusElement.innerHTML = `<p>${message}</p>`;
            
            setTimeout(() => {
                statusElement.innerHTML = `
                    <p>üü¢ GPS: Active | üü¢ Firebase: Connected | üü¢ Services: 83 loaded</p>
                    <p>üë§ User: Demo Mode | üì± Platform: Android 12 | üîã Battery: 85%</p>
                `;
            }, 3000);
        }
        
        // Animate service cards periodically
        function animateServiceCards() {
            const cards = document.querySelectorAll('.service-card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        card.style.transform = 'scale(1)';
                    }, 200);
                }, index * 100);
            });
        }
        
        // Run animation every 8 seconds
        setInterval(animateServiceCards, 8000);
        
        function openFullMap() {
            document.getElementById('fullMapContainer').classList.add('active');
            
            setTimeout(() => {
                initializeFullMap();
            }, 100);
        }
        
        function closeFullMap() {
            document.getElementById('fullMapContainer').classList.remove('active');
            
            if (fullMap) {
                fullMap.remove();
                fullMap = null;
            }
        }
        
        function initializeFullMap() {
            if (fullMap) {
                fullMap.remove();
            }
            
            fullMap = L.map('fullMap').setView(userLocation, 14);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(fullMap);
            
            // Add user location marker
            const fullUserMarker = L.marker(userLocation, {
                icon: L.divIcon({
                    html: 'üìç',
                    className: 'user-marker-large',
                    iconSize: [30, 30]
                })
            }).addTo(fullMap).bindPopup("Your Location");
            
            // Add all services to the map
            Object.keys(serviceData).forEach(serviceType => {
                serviceData[serviceType].forEach(service => {
                    L.marker(service.coords, {
                        icon: L.divIcon({
                            html: getServiceIcon(serviceType),
                            className: 'service-marker-large',
                            iconSize: [25, 25]
                        })
                    }).addTo(fullMap).bindPopup(`
                        <strong>${service.name}</strong><br>
                        ${service.address}<br>
                        <button onclick="navigateToService('${serviceType}', '${service.name}')" 
                                style="margin-top: 5px; padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Navigate Here
                        </button>
                    `);
                });
            });
            
            // If navigation is active, show route
            if (navigationActive && selectedDestination) {
                const fullRoutePolyline = L.polyline([userLocation, selectedDestination.coords], {
                    color: '#4CAF50',
                    weight: 6,
                    opacity: 0.8
                }).addTo(fullMap);
                
                document.getElementById('navigationInfo').style.display = 'block';
                fullMap.fitBounds([userLocation, selectedDestination.coords], { padding: [50, 50] });
            }
        }
        
        function navigateToService(serviceType, serviceName) {
            const service = serviceData[serviceType].find(s => s.name === serviceName);
            if (service) {
                selectedDestination = service;
                startNavigation();
                
                // Update the full map
                if (fullMap) {
                    const fullRoutePolyline = L.polyline([userLocation, selectedDestination.coords], {
                        color: '#4CAF50',
                        weight: 6,
                        opacity: 0.8
                    }).addTo(fullMap);
                    
                    document.getElementById('navigationInfo').style.display = 'block';
                    fullMap.fitBounds([userLocation, selectedDestination.coords], { padding: [50, 50] });
                }
            }
        }
        
        function centerOnUser() {
            if (fullMap) {
                fullMap.setView(userLocation, 16);
                updateDemoStatus("üìç Centered on your location");
            }
        }
        
        function toggleTraffic() {
            updateDemoStatus("üö¶ Traffic layer toggled (demo feature)");
            // In a real app, this would toggle traffic overlay
        }
        
        // GPS Location Detection
        function detectUserLocation() {
            updateDemoStatus("üìç Detecting your location...");
            
            if (!navigator.geolocation) {
                updateDemoStatus("‚ùå Geolocation not supported - Using demo location");
                return;
            }
            
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 300000 // 5 minutes
            };
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    actualUserLocation = [lat, lng];
                    userLocation = [lat, lng];
                    isLocationDetected = true;
                    
                    updateLocationDisplay(lat, lng, accuracy);
                    updateDemoStatus(`üìç Location detected with ${Math.round(accuracy)}m accuracy`);
                    
                    // Update service data based on real location
                    updateServicesForLocation(lat, lng);
                    
                    // Update maps if they're already initialized
                    if (miniMap && userMarker) {
                        userMarker.setLatLng([lat, lng]);
                        miniMap.setView([lat, lng], 13);
                    }
                    
                    if (fullMap) {
                        fullMap.setView([lat, lng], 14);
                    }
                },
                (error) => {
                    handleLocationError(error);
                },
                options
            );
            
            // Watch position for continuous updates
            if (navigator.geolocation) {
                locationWatchId = navigator.geolocation.watchPosition(
                    (position) => {
                        if (isLocationDetected) {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            
                            userLocation = [lat, lng];
                            
                            // Update markers if maps are active
                            if (miniMap && userMarker) {
                                userMarker.setLatLng([lat, lng]);
                            }
                        }
                    },
                    (error) => {
                        console.log('Location watch error:', error);
                    },
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 60000 }
                );
            }
        }
        
        function handleLocationError(error) {
            let errorMessage = "‚ùå Location access denied - Using demo location";
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = "‚ùå Location permission denied - Using demo location (Bhopal, India)";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = "‚ùå Location unavailable - Using demo location";
                    break;
                case error.TIMEOUT:
                    errorMessage = "‚è±Ô∏è Location timeout - Using demo location";
                    break;
            }
            
            updateDemoStatus(errorMessage);
            
            // Show location permission help
            setTimeout(() => {
                if (!isLocationDetected) {
                    showLocationHelp();
                }
            }, 2000);
        }
        
        function showLocationHelp() {
            const helpDiv = document.createElement('div');
            helpDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #FF6B6B, #FF8E53);
                color: white;
                padding: 20px;
                border-radius: 15px;
                max-width: 300px;
                z-index: 10001;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                animation: slideInRight 0.5s ease;
            `;
            
            helpDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <strong>üìç Enable Location</strong>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">‚úï</button>
                </div>
                <p style="font-size: 0.9rem; margin-bottom: 15px;">
                    For the best experience, please allow location access to see services near you!
                </p>
                <button onclick="detectUserLocation(); this.parentElement.remove();" 
                        style="width: 100%; padding: 10px; background: white; color: #FF6B6B; border: none; border-radius: 25px; font-weight: bold; cursor: pointer;">
                    üîÑ Try Again
                </button>
            `;
            
            document.body.appendChild(helpDiv);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (helpDiv.parentElement) {
                    helpDiv.remove();
                }
            }, 10000);
        }
        
        function updateLocationDisplay(lat, lng, accuracy) {
            // Use reverse geocoding to get location name
            fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lng}&localityLanguage=en`)
                .then(response => response.json())
                .then(data => {
                    const city = data.city || data.locality || 'Unknown City';
                    const country = data.countryName || 'Unknown Country';
                    const locationText = `üìç Current Location: ${city}, ${country}`;
                    
                    document.getElementById('locationDisplay').textContent = locationText;
                    updateDemoStatus(`üìç Located in ${city}, ${country} (¬±${Math.round(accuracy)}m)`);
                })
                .catch(error => {
                    console.log('Geocoding error:', error);
                    document.getElementById('locationDisplay').textContent = 
                        `üìç Current Location: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                });
        }
        
        function updateServicesForLocation(lat, lng) {
            // Generate realistic service counts based on location type
            const isUrbanArea = Math.random() > 0.3; // 70% chance of urban area
            const baseMultiplier = isUrbanArea ? 1 : 0.3;
            
            // Update service counts dynamically
            const serviceCounts = {
                hospitals: Math.floor((8 + Math.random() * 15) * baseMultiplier),
                police: Math.floor((5 + Math.random() * 10) * baseMultiplier),
                fire: Math.floor((3 + Math.random() * 8) * baseMultiplier),
                schools: Math.floor((15 + Math.random() * 25) * baseMultiplier),
                government: Math.floor((8 + Math.random() * 12) * baseMultiplier),
                pharmacies: Math.floor((10 + Math.random() * 20) * baseMultiplier)
            };
            
            // Update the display
            document.querySelectorAll('.service-card').forEach(card => {
                const serviceType = card.onclick.toString().match(/'(\w+)'/)[1];
                const countElement = card.querySelector('.service-count');
                if (countElement && serviceCounts[serviceType]) {
                    countElement.textContent = `${serviceCounts[serviceType]} nearby`;
                }
            });
            
            // Generate nearby services based on actual location
            generateNearbyServices(lat, lng);
        }
        
        function generateNearbyServices(lat, lng) {
            // Generate realistic nearby services based on the user's location
            const serviceTypes = ['hospitals', 'police', 'fire', 'schools', 'government', 'pharmacies'];
            
            serviceTypes.forEach(serviceType => {
                const services = [];
                const count = Math.floor(Math.random() * 5) + 3; // 3-7 services per type
                
                for (let i = 0; i < count; i++) {
                    // Generate coordinates within 5km radius
                    const distance = Math.random() * 0.05; // ~5km in degrees
                    const angle = Math.random() * 2 * Math.PI;
                    
                    const serviceLat = lat + (distance * Math.cos(angle));
                    const serviceLng = lng + (distance * Math.sin(angle));
                    const distanceKm = (Math.random() * 4.5 + 0.5).toFixed(1); // 0.5-5.0 km
                    
                    services.push({
                        name: generateServiceName(serviceType, i),
                        address: `${Math.floor(Math.random() * 999) + 1} Local Street`,
                        distance: `${distanceKm} km`,
                        coords: [serviceLat, serviceLng]
                    });
                }
                
                // Update the service data
                serviceData[serviceType] = services;
            });
        }
        
        function generateServiceName(serviceType, index) {
            const names = {
                hospitals: ['City General Hospital', 'Regional Medical Center', 'Community Health Clinic', 'Emergency Care Center', 'Family Health Hospital'],
                police: ['Local Police Station', 'Community Police Post', 'District Police HQ', 'Traffic Police Station', 'Emergency Response Unit'],
                fire: ['Fire Station', 'Emergency Fire Department', 'Rescue Services Center', 'Fire & Safety Station', 'Emergency Response Station'],
                schools: ['Public Elementary School', 'Community High School', 'Local Primary School', 'Regional Secondary School', 'Community College'],
                government: ['City Hall', 'Municipal Office', 'Government Services Center', 'Public Administration Office', 'Civic Center'],
                pharmacies: ['City Pharmacy', 'Health Plus Pharmacy', 'Community Drug Store', 'Medical Supplies Store', 'Local Pharmacy']
            };
            
            return names[serviceType][index % names[serviceType].length];
        }
        
        // Enhanced location update function
        function simulateLocationUpdate() {
            if (isLocationDetected && actualUserLocation) {
                // Small random movement around actual location (simulate movement)
                const randomOffset = 0.001; // ~100m
                const newLat = actualUserLocation[0] + (Math.random() - 0.5) * randomOffset;
                const newLng = actualUserLocation[1] + (Math.random() - 0.5) * randomOffset;
                
                userLocation = [newLat, newLng];
                updateLocationDisplay(newLat, newLng, 50);
            } else {
                // Fallback to original simulation
                const locations = [
                    [23.2599, 77.4126], // Bhopal
                    [28.6139, 77.2090], // Delhi
                    [19.0760, 72.8777], // Mumbai
                    [12.9716, 77.5946], // Bangalore
                ];
                
                const randomLocation = locations[Math.floor(Math.random() * locations.length)];
                userLocation = randomLocation;
                
                // Update display with city names
                const cityNames = ['Bhopal, India', 'Delhi, India', 'Mumbai, India', 'Bangalore, India'];
                const cityIndex = locations.findIndex(loc => loc[0] === randomLocation[0]);
                document.getElementById('locationDisplay').textContent = `üìç Current Location: ${cityNames[cityIndex]}`;
            }
            
            // Update service counts
            updateServicesForLocation(userLocation[0], userLocation[1]);
            updateDemoStatus("üü° Location updated - Refreshing nearby services...");
            
            setTimeout(() => {
                updateDemoStatus("üü¢ GPS: Active | üü¢ Firebase: Connected | üü¢ Services: Updated");
            }, 2000);
        }
        
        // Initial animation after page load
        window.addEventListener('load', () => {
            setTimeout(animateServiceCards, 1000);
            
            // Detect user location on page load
            setTimeout(() => {
                detectUserLocation();
            }, 2000);
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (locationWatchId) {
                navigator.geolocation.clearWatch(locationWatchId);
            }
        });
        
        console.log('üó∫Ô∏è ResQMap Demo loaded successfully!');
        console.log('üì± Interactive demo ready - Try the control buttons!');
        console.log('üó∫Ô∏è Features: Live navigation, distance tracking, interactive maps!');
        console.log('üìç Real GPS location detection enabled!');
    </script>
</body>
</html>